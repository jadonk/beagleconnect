<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.8.dev">
<title>BeagleConnect™</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body id="beagleconnect" class="article">
<div id="header">
<h1>BeagleConnect™</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>BeagleConnect™ is a revolutionary technology virtually eliminating low-level software development for <a href="https://en.wikipedia.org/wiki/Internet_of_things">IoT</a> and <a href="https://en.wikipedia.org/wiki/Industrial_internet_of_things">IIoT</a> applications, such as building automation, factory automation, home automation, and scientific data acquisition. While numerous IoT and IIoT solutions available today provide massive software libraries for microcontrollers <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> supporting a limited body of <a href="https://en.wikipedia.org/wiki/Sensor">sensors</a>, <a href="https://en.wikipedia.org/wiki/Actuator">actuators</a> and <a href="https://en.wikipedia.org/wiki/Indicator_(distance_amplifying_instrument)">indicators</a> as well as libraries for communicating over various networks, BeagleConnect simply eliminates the need for these libraries by shifting the burden into the most massive and collaborative software project of all time, the <a href="https://en.wikipedia.org/wiki/Linux_kernel">Linux kernel</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graphics/BeagleConnect-Freedom-C5-Boards.png" alt="BeagleConnect Freedom C5 Boards">
</div>
</div>
<div class="paragraph">
<p>These are the tools used to automate things in <a href="https://en.wikipedia.org/wiki/Data_collection_system">scientific data collection</a>, <a href="https://en.wikipedia.org/wiki/Data_science">data science</a>, <a href="https://en.wikipedia.org/wiki/Mechatronics">mechatronics</a>, and <a href="https://en.wikipedia.org/wiki/Internet_of_things">IoT</a>.</p>
</div>
<div class="paragraph">
<p>BeagleConnect™ technology solves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The need to write software to add a large set of diverse devices to your system,</p>
</li>
<li>
<p>The need to maintain the software with security updates,</p>
</li>
<li>
<p>The need to rapidly prototype using off-the-shelf software and hardware without wiring,</p>
</li>
<li>
<p>The need to connect to devices using long-range, low-power wireless, and</p>
</li>
<li>
<p>The need to produce high-volume custom hardware cost-optimized for your requirements.</p>
</li>
</ul>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#truebeagleconnect-experience">BeagleConnect™ experience</a></li>
<li><a href="#truebeagleconnect-hardware">BeagleConnect™ hardware</a>
<ul class="sectlevel1">
<li><a href="#truebeagleconnect-freedom">BeagleConnect™ Freedom</a></li>
<li><a href="#beta-kit">BeagleConnect™ Freedom beta kit</a></li>
<li><a href="#truebeagleconnect-mobile-gateway">BeagleConnect™ Mobile Gateway</a></li>
</ul>
</li>
<li><a href="#story">The Story Behind BeagleConnect™</a>
<ul class="sectlevel1">
<li><a href="#long-background">The Long Background</a>
<ul class="sectlevel2">
<li><a href="#truegetting-started-in-electronics">Getting Started in Electronics</a></li>
<li><a href="#truebut-what-about-keyboard-users">But, what about keyboard users?</a></li>
<li><a href="#truefind-out-more">Find out more</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#architecture">Architecture</a>
<ul class="sectlevel1">
<li><a href="#beagleconnect-leash">BeagleConnect™ Freedom</a></li>
<li><a href="#what-is-new">What makes BeagleConnect™ new and different?</a>
<ul class="sectlevel2">
<li><a href="#the-device-interface-software-is-already-done">The device interface software is already done</a></li>
<li><a href="#on-going-maintenance">On-going maintenance</a></li>
<li><a href="#rapid-prototyping-without-wiring">Rapid prototyping without wiring</a></li>
<li><a href="#long-range-low-power-wireless">Long-range, low-power wireless</a></li>
<li><a href="#full-customization-possible">Full customization possible</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#usage">Usage</a>
<ul class="sectlevel1">
<li><a href="#beagleconnect-user-experience">BeagleConnect™ wireless user experience</a>
<ul class="sectlevel2">
<li><a href="#enable-a-linux-host-with-beagleconnect">Enable a Linux host with BeagleConnect™</a></li>
<li><a href="#connect-host-and-device">Connect host and device</a></li>
<li><a href="#device-data-shows-up-as-files">Device data shows up as files</a></li>
</ul>
</li>
<li><a href="#components">Components</a></li>
<li><a href="#whats-different">What&#8217;s different</a></li>
</ul>
</li>
<li><a href="#development">Develop for BeagleConnect™ Freedom with Zephyr</a>
<ul class="sectlevel1">
<li><a href="#equipment">Equipment to begin development</a>
<ul class="sectlevel2">
<li><a href="#truerequired">Required</a></li>
<li><a href="#truerecommended">Recommended</a></li>
<li><a href="#trueoptional">Optional</a></li>
</ul>
</li>
<li><a href="#trueinstall-the-latest-software-image-for-beaglebone-green-gateway">Install the latest software image for BeagleBone Green Gateway</a></li>
<li><a href="#truelog-into-beaglebone-green-gateway">Log into BeagleBone Green Gateway</a></li>
<li><a href="#sdk">Install Zephyr development tools on BeagleBone Green Gateway</a></li>
<li><a href="#truebuild-applications-for-beagleconnect-freedom-on-beaglebone-green-gateway">Build applications for BeagleConnect Freedom on BeagleBone Green Gateway</a></li>
<li><a href="#trueflash-applications-to-beagleconnect-freedom-from-beaglebone-green-gateway">Flash applications to BeagleConnect Freedom from BeagleBone Green Gateway</a></li>
<li><a href="#truedebug-applications-over-the-serial-terminal">Debug applications over the serial terminal</a></li>
</ul>
</li>
<li><a href="#work-in-progress">Work in progress</a>
<ul class="sectlevel1">
<li><a href="#background">Background</a>
<ul class="sectlevel2">
<li><a href="#high-level">High-level</a></li>
<li><a href="#software-architecture">Software architecture</a></li>
<li><a href="#todo-items">TODO items</a></li>
<li><a href="#associated-pre-work">Associated pre-work</a></li>
<li><a href="#user-experience-concerns">User experience concerns</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#demo-1">BeagleConnect™ Greybus demo using BeagleConnect™ Freedom</a>
<ul class="sectlevel1">
<li><a href="#trueintroduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#truewhy">Why??</a></li>
<li><a href="#truehistory">History</a></li>
<li><a href="#truehardware-requirements">Hardware requirements</a></li>
</ul>
</li>
<li><a href="#truerunning-the-demo">Running the demo</a>
<ul class="sectlevel2">
<li><a href="#trueinstall-the-latest-software-image">Install the latest software image</a></li>
<li><a href="#trueflash-beagleconnect-freedom-gateway-device">Flash BeagleConnect™ Freedom <strong>gateway</strong> device</a></li>
<li><a href="#truetest-gateway-using-pre-programmed-node-firmware">Test gateway using pre-programmed node firmware</a></li>
<li><a href="#trueflash-beagleconnect-freedom-node-device-with-greybus-firmware">Flash BeagleConnect™ Freedom <strong>node</strong> device with Greybus firmware</a></li>
<li><a href="#trueflashing-via-a-linux-host">Flashing via a Linux Host</a></li>
</ul>
</li>
<li><a href="#trueobserve-the-node-device">Observe the node device</a>
<ul class="sectlevel2">
<li><a href="#trueconsole-tio">Console (<code>tio</code>)</a></li>
<li><a href="#truethe-zephyr-shell">The Zephyr Shell</a></li>
</ul>
</li>
<li><a href="#truerebuilding-from-source">Rebuilding from source</a>
<ul class="sectlevel2">
<li><a href="#trueprerequisites">Prerequisites</a></li>
<li><a href="#truecloning-the-repository">Cloning the repository</a></li>
<li><a href="#truezephyr">Zephyr</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#trueping-pong">Ping Pong</a></li>
<li><a href="#truegreybus">Greybus</a></li>
<li><a href="#trueblinky">Blinky!</a></li>
<li><a href="#trueread-i2c-registers">Read I2C Registers</a></li>
<li><a href="#trueconclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<h1 id="truebeagleconnect-experience" class="sect0"><a class="anchor" href="#truebeagleconnect-experience"></a>BeagleConnect™ experience</h1>
<div class="paragraph">
<p>BeagleConnect™ provides a scalable experience for interacting with the physical world.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The term <em>BeagleConnect™</em> refers to a technology comprising of a family of boards, a collection of Linux kernel drivers, microcontroller firmware, a communication protocol, and system-level integration to automation software tools. More specific terms will be applied in the architecture details. The term is also used here to represent the experience introduced to users through the initial <em>BeagleConnect™ Freedom</em> product consisting of a board and case which ships programmed and ready to be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For scientists, we are integrating <a href="https://jupyter.org/">Jupyter Notebook</a> with the data streams from any of hundreds of sensor options, including <a href="https://www.mikroe.com/click/sensors/force">vibration</a>, <a href="https://www.mikroe.com/click/sensors/gas">gas detection</a>, <a href="https://www.mikroe.com/click/sensors/biometrics">biometrics</a> and <a href="https://www.mikroe.com/click/sensors">more</a>. These data streams can be stored in simple <a href="https://en.wikipedia.org/wiki/Comma-separated_values">data files</a> or processed and visualized.</p>
</div>
<div class="paragraph">
<p>#TODO: provide images demonstrating Jupyter Notebook visualization</p>
</div>
<div class="paragraph">
<p>For embedded systems developers, data is easily extrated using the standard <a href="https://www.kernel.org/doc/html/latest/driver-api/iio/index.html">IIO</a> interface provided by the <a href="https://kernel.org">Linux kernel</a> running on the gateway using any of hundreds of programming languages and environments, without writing a line of microcontroller firmware. The Linux environment provides opportunities for high-level remote management using tools like <a href="https://balena.io">Balena</a> with applications deployed in <a href="https://docker.io">Docker</a> containers.</p>
</div>
<div class="paragraph">
<p>#TODO: provide image illustrating remote management</p>
</div>
<div class="paragraph">
<p>The hardware and software are fully open source, providing for scalability and a lack of vendor lock-in.</p>
</div>
<div class="paragraph">
<p>For DevOps&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>For home automaters, integration into <a href="https://webthings.io">WebThings</a>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>#TODO: think a bit more about this section with some feedback from Cathy.</p>
</div>
<h1 id="truebeagleconnect-hardware" class="sect0"><a class="anchor" href="#truebeagleconnect-hardware"></a>BeagleConnect™ hardware</h1>
<div class="sect1">
<h2 id="truebeagleconnect-freedom"><a class="anchor" href="#truebeagleconnect-freedom"></a>BeagleConnect™ Freedom</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="graphics/BeagleConnect-Freedom-C5-HandPhoto.png" alt="BeagleConnect Freedom C5 HandPhoto">
</div>
</div>
<div class="paragraph">
<p>#TODO: provide image of BeagleConnect™ Freedom in case with a hand for size perspective</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<em>BeagleConnect™ Freedom</em> enables wirelessly adding new device nodes and is targeted to cost initially around US$20 with a roadmap to variants as low as US$1.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The initial <em>BeagleConnect™ Freedom</em> production release will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support at least 100 <a href="https://elinux.org/Mikrobus">mikroBUS</a>-based <a href="https://mikroe.com/click">Click boards from Mikroelectronika</a>,</p>
</li>
<li>
<p>Work with <a href="https://en.wikipedia.org/wiki/Bluetooth_Low_Energy">Bluetooth Low Energy (BLE)</a>-enabled Linux computers at 2.4GHz,</p>
</li>
<li>
<p>Work with long-range sub-1GHz <a href="https://en.wikipedia.org/wiki/IEEE_802.15.4">IEEE 802.15.4 wireless connections</a> at 500 meters with data rates of 1kbps, and</p>
</li>
<li>
<p>Work with a low-cost BeagleBoard.org Linux <a href="https://en.wikipedia.org/wiki/Single-board_computer">single-board computer (SBC)</a> as a <code>BeagleConnect™ gateway device</code> and
work with at least 10 other <code>BeagleConnect™ node devices</code> each supporting 2 add-on sensor, actuator or indicator devices.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Future releases will be collaborated with the community, evolve dynamically, and contain additional functionality. The goal is to support over 500 add-on devices within the first year after the initial release.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="beta-kit"><a class="anchor" href="#beta-kit"></a>BeagleConnect™ Freedom beta kit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A small number of beta kits have been assembled with BeagleConnect™ Freedom rev C5 boards, which is the version that should be taken to production.</p>
</div>
<div class="paragraph">
<p>The kit includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1x <a href="https://wiki.seeedstudio.com/BeagleBone-Green-Gateway/">Seeed BeagleBone® Green Gateway</a> (board, USB cable)</p>
</li>
<li>
<p>3x BeagleConnect™ Freedom (board, attenna, USB cable)</p>
</li>
<li>
<p>1x <a href="https://www.mikroe.com/unique-id-click">MikroElektronikia Click ID Board</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To get started with this kit, see <a href="#demo-1">BeagleConnect™ Greybus demo using BeagleConnect™ Freedom</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truebeagleconnect-mobile-gateway"><a class="anchor" href="#truebeagleconnect-mobile-gateway"></a>BeagleConnect™ Mobile Gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a work-in-progress that will be released as the first integrated BeagleConnect™ gateway. It is possible to assemble a gateway with any Linux computer, but this computer will ship setup and ready to go.</p>
</div>
<div class="paragraph">
<p>The gateway is built from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BeagleBoard.org PocketBeagle,</p>
</li>
<li>
<p>BeagleConnect™ Freedom,</p>
</li>
<li>
<p>a cellular modem,</p>
</li>
<li>
<p>a USB WiFi dongle,</p>
</li>
<li>
<p>antennas, and</p>
</li>
<li>
<p>an enclosure.</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="story" class="sect0"><a class="anchor" href="#story"></a>The Story Behind BeagleConnect™</h1>
<div class="sect1">
<h2 id="long-background"><a class="anchor" href="#long-background"></a>The Long Background</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many stories behind BeagleConnect™, mine is just one of them. It begins
with my mom teaching me about computers. She told me I could anything I wanted
with ours, as long as I didn&#8217;t open the case. This was the late-70s/early-80s, so
all she needed to do was put her <a href="https://en.wikipedia.org/wiki/Floppy_disk">floppy disk</a>
away and there wasn&#8217;t risk of me damaging the family photo album or her ability to
do her work the next day. I listened and learned from her the basics of programming, but
it wasn&#8217;t long before I wanted to take the computer apart.</p>
</div>
<div class="sect2">
<h3 id="truegetting-started-in-electronics"><a class="anchor" href="#truegetting-started-in-electronics"></a>Getting Started in Electronics</h3>
<div class="paragraph">
<p>Exploring <a href="http://www.forrestmims.org/">Getting Started in Electronics</a> satisfied my itch for quite a while. Eventually, I got a Commodore 64 and began connecting voice synthesizer ICs to it. My interest in computers and electronics flourished into an electrical engineering degree and a long career in the semiconductor industry.</p>
</div>
<div class="paragraph">
<p>Over this time, I&#8217;ve become more and more alarmed with the progress of technology. Now, to be clear, I love technology. I love innovation and invention. It is just that some things have evolved in a sort of tunnel-vision, without bringing everyone along.</p>
</div>
</div>
<div class="sect2">
<h3 id="truebut-what-about-keyboard-users"><a class="anchor" href="#truebut-what-about-keyboard-users"></a>But, what about keyboard users?</h3>
<div class="paragraph">
<p>As graphical user interfaces and mice took over computers, they rapidly became almost unusable by my mom. She typed well, but the dexterity to move a mouse aluded her. To satisfy the need to interact with locations on the screen, she adopted using a joystick and her productivity came to a crawl. How is it that such assumptions could be made impacting <strong>all</strong> computer users without any thoughtful provisions for what already worked?</p>
</div>
</div>
<div class="sect2">
<h3 id="truefind-out-more"><a class="anchor" href="#truefind-out-more"></a>Find out more</h3>
<div class="paragraph">
<p>Get on <a href="https://beagleboard.org/about/jkridner">my calendar</a> if you&#8217;d like to chat with me more about this story.</p>
</div>
</div>
</div>
</div>
<h1 id="architecture" class="sect0"><a class="anchor" href="#architecture"></a>Architecture</h1>
<div class="sect1">
<h2 id="beagleconnect-leash"><a class="anchor" href="#beagleconnect-leash"></a>BeagleConnect™ Freedom</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>BeagleConnect™ Freedom</em> is based on the <a href="https://www.ti.com/product/CC1352R">TI CC1352</a> and is the first available BeagleConnect™ solution. It implements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BeagleConnect™ gateway device</code> function for Sub-GHz 802.15.4 long-range wireless</p>
</li>
<li>
<p><code>BeagleConnect™ node device</code> function for Bluetooth Low-Energe (BLE) and Sub-GHz 802.15.4 long range wireless</p>
</li>
<li>
<p>USB-based serial console and firmware updates</p>
</li>
<li>
<p>2x <a href="https://www.mikroe.com/mikrobus">mikroBUS sockets</a> with <code>BeagleConnect™ protocol support</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-is-new"><a class="anchor" href="#what-is-new"></a>What makes BeagleConnect™ new and different?</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
BeagleConnect™ solves IoT in a different and better way than any previous
solution.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="the-device-interface-software-is-already-done"><a class="anchor" href="#the-device-interface-software-is-already-done"></a>The device interface software is already done</h3>
<div class="paragraph">
<p>BeagleConnect™ uses the collaboratively developed Linux kernel to contain the intelligence required to speak to these devices (sensors, actuators, and indicators), rather than relying on writing code on a
microcontroller specific to these devices. Some existing solutions rely on large libraries of microcontroller code, but the integration of communications, maintenance of the library with a limited set of
developer resources and other constraints to be explained later make
those other solutions less suitable for rapid prototyping than
BeagleConnect™.</p>
</div>
<div class="paragraph">
<p>Linux presents these devices abstractly in ways that are
self-descriptive. Add an accelerometer to the system and you are
automatically fed a stream of force values in standard units. Add a
temperature sensor and you get it back in standard units again. Same for sensing magnetism, proximity, color, light, frequency, orientation, or multitudes of other inputs. Indicators, such as LEDs and displays, are similarly abstracted with a few other kernel subsystems and more advanced actuators with and without feedback control are in the process of being developed and standardized. In places where proper Linux kernel drivers exist, no new specialized code needs to be created for the devices.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<em>Bottom line</em>: For hundreds of devices, users won&#8217;t have to write a single line of code to add them their systems. The automation code they do write can be extremely simple, done with graphical tools or in any language they want. Maintenance of the code is centralized in a small reusable set of microcontroller firmware and the Linux kernel, which is highly peer reviewed under a <a href="https://wiki.p2pfoundation.net/Linux_-_Governance">highly-regarded governance model</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="on-going-maintenance"><a class="anchor" href="#on-going-maintenance"></a>On-going maintenance</h3>
<div class="paragraph">
<p>Because there isn&#8217;t code specific to any given network-of-devices
configuration, we can all leverage the same software code base. This
means that when someone fixes an issue in either BeagleConnect™ firmware or the Linux kernel, you benefit from the fixes. The source for BeagleConnect™ firmware is also submitted to the <a href="https://www.zephyrproject.org/">Zephyr Project</a> upstream, further increasing the user base. Additionally, we will maintain stable branches of the software and provide mechanisms for updating firmware on BeagleConnect™ hardware. With a single, relatively small firmware load, the potential for bugs is kept low. With large user base, the potential for discovering and resolving bugs is high.</p>
</div>
</div>
<div class="sect2">
<h3 id="rapid-prototyping-without-wiring"><a class="anchor" href="#rapid-prototyping-without-wiring"></a>Rapid prototyping without wiring</h3>
<div class="paragraph">
<p>BeagleConnect™ utilizes the <a href="https://elinux.org/Mikrobus">mikroBUS
standard</a>. The mikroBUS standard interface is flexible enough for almost any typical sensor or indicator with hundreds of devices available.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, we have support in the Linux kernel for a bit over 100 <em>Click</em> mikroBUS add-on boards from Mikroelektronika and are working with Mikroelektronika on a updated version of the specification for these boards to self-identify. Further, eventually the vast majority of over 800 currently available <em>Click</em> mikroBUS add-on boards will be supported as well as the hundreds of compliant boards developed every year.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="long-range-low-power-wireless"><a class="anchor" href="#long-range-low-power-wireless"></a>Long-range, low-power wireless</h3>
<div class="paragraph">
<p><em>BeagleConnect™ Freedom</em> wireless hardware is built around a
<a href="http://www.ti.com/product/CC1352R">TI CC1352</a> multiprotocol and multi-band Sub-1 GHz and 2.4-GHz wireless microcontroller (MCU). CC1352R includes a 48-MHz Arm® Cortex®-M4F processor, 352KB Flash, 256KB ROM, 8KB Cache SRAM, 80KB of ultra-low leakage SRAM, and <a href="https://en.wikipedia.org/wiki/Over-the-air_programming">Over-the-Air</a> upgrades (OTA).</p>
</div>
</div>
<div class="sect2">
<h3 id="full-customization-possible"><a class="anchor" href="#full-customization-possible"></a>Full customization possible</h3>
<div class="paragraph">
<p>BeagleConnect™ utilizes <a href="https://www.oshwa.org/definition/">open source
hardware</a> and <a href="https://en.wikipedia.org/wiki/Open-source_software">open
source software</a>, making it possible to optimize hardware and software
implementations and sourcing to meet end-product requirements. BeagleConnect™ is meant to enable rapid-prototyping and not to necessarily satisfy any particular end-product&#8217;s requirements, but with full considerations for go-to-market needs.</p>
</div>
<div class="paragraph">
<p>Each BeagleBoard.org BeagleConnect™ solution will be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Readily available for over 10 years,</p>
</li>
<li>
<p>Built with fully
open source software with submissions to mainline Linux and Zephyr repositories to aide in support and porting,</p>
</li>
<li>
<p>Built with fully open source and non-restrictive hardware design including schematic, bill-of-materials, layout, and manufacturing files (with only the BeagleBoard.org logo removed due to licensing restrictions of our brand),</p>
</li>
<li>
<p>Built with parts where at least a compatible part is available from worldwide distributors in any quantity,</p>
</li>
<li>
<p>Built with design and manufacturing partners able to help scale derivative designs,</p>
</li>
<li>
<p>Based on a security model using public/private keypairs that can be replaced to secure your own network, and</p>
</li>
<li>
<p>Fully FCC/CE certified.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="usage" class="sect0"><a class="anchor" href="#usage"></a>Usage</h1>
<div class="paragraph">
<p>This section describes the usage model we are developing. To use the current code in development,
please refer to the <a href="#development">Develop for BeagleConnect™ Freedom with Zephyr</a> section below.</p>
</div>
<div class="sect1">
<h2 id="beagleconnect-user-experience"><a class="anchor" href="#beagleconnect-user-experience"></a>BeagleConnect™ wireless user experience</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="enable-a-linux-host-with-beagleconnect"><a class="anchor" href="#enable-a-linux-host-with-beagleconnect"></a>Enable a Linux host with BeagleConnect™</h3>
<div class="paragraph">
<p><span class="image"><img src="https://github.com/beagleboard/beagleconnect/blob/master/docs/ProvStep1.PNG?raw=true" alt="Provisioning Step 1"></span></p>
</div>
<div class="paragraph">
<p>Log into a host system running Linux that is BeagleConnect™ enabled. Enable a Linux host with BeagleConnect™ by plugging a <code>BeagleConnect™ gateway device</code> into it&#8217;s USB port. You&#8217;ll also want to have a <code>BeagleConnect™ node device</code> with a sensor, actuator or indicator device connected.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>BeagleConnect™ Freedom</em> can act as either a <code>BeagleConnect™ gateway device</code> or a
<code>BeagleConnect™ node device</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The Linux host will need to run the <code>BeagleConnect™ management software</code>, most of which is incorporated into the Linux kernel. Support will be provided for BeagleBoard and BeagleBone boards, x86 hosts, and Raspberry Pi.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><mark>TODO: Clean up images</mark></p>
</div>
</div>
<div class="sect2">
<h3 id="connect-host-and-device"><a class="anchor" href="#connect-host-and-device"></a>Connect host and device</h3>
<div class="paragraph">
<p><span class="image"><img src="https://github.com/beagleboard/beagleconnect/blob/master/docs/ProvStep2.PNG?raw=true" alt="Provisioning Step 2"></span></p>
</div>
<div class="paragraph">
<p>Initiate a connection between the host and devices by pressing the discovery button(s).</p>
</div>
</div>
<div class="sect2">
<h3 id="device-data-shows-up-as-files"><a class="anchor" href="#device-data-shows-up-as-files"></a>Device data shows up as files</h3>
<div class="paragraph">
<p><span class="image"><img src="https://github.com/beagleboard/beagleconnect/blob/master/docs/ProvStep3.PNG?raw=true" alt="Provisioning Step 3"></span></p>
</div>
<div class="paragraph">
<p>New streams of self-describing data show up on the host system using native device drivers.</p>
</div>
<div class="paragraph">
<p>High-level applications, like <code>Node-RED</code>, can directly read/write these high-level data streams (including data-type information) to Internet-based <a href="https://mqtt.org/">MQTT</a> brokers, live dashboards, or other logical operations without requiring any sensor-specific coding. Business logic can be applied using simple if-this-then-that style operations or be made as complex as desired using virtually any programming language or environment.</p>
</div>
<div class="paragraph">
<p><mark>TODO: Actually, Node-RED will make these show up automatically as streams.</mark></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="components"><a class="anchor" href="#components"></a>Components</h2>
<div class="sectionbody">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
BeagleConnect™ enabled host
</td>
<td class="hdlist2">
<p>Linux computer, possibly single-board computer (SBC), with <code>BeagleConnect™ management software</code> and <code>BeagleConnect™ gateway function</code>. <code>BeagleConnect™ gateway function</code> can be provided by a <code>BeagleConnect™ compatible interface</code> or by connecting a <code>BeagleConnect™ gateway device</code> over USB.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the Linux host has BLE, the BeagleConnect™ is optional for short distances
</td>
</tr>
</table>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
BeagleConnect™ Freedom
</td>
<td class="hdlist2">
<p>Board, case, and wireless MCU with <code>Zephyr</code> based firmware for acting as either a <code>BeagleConnect™ gateway device</code> or <code>BeagleConnect™ node device</code>.</p>
<div class="ulist">
<ul>
<li>
<p>In <code>BeagleConnect™ gateway device</code> mode:</p>
<div class="ulist">
<ul>
<li>
<p>Provides long-range, low-power wireless communications,</p>
</li>
<li>
<p>Connects with the <code>host</code> via USB and an associated Linux kernel driver, and</p>
</li>
<li>
<p>Is powered by the USB connector.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In <code>BeagleConnect™ node device</code> mode:</p>
<div class="ulist">
<ul>
<li>
<p>Powered by a battery or USB connector</p>
</li>
<li>
<p>Provides 2 mikroBUS connectors for connecting any of hundreds of <a href="https://bbb.io/click">Click Board</a> mikroBUS add-on devices</p>
</li>
<li>
<p>Provides new Linux host controllers for SPI, I2C, UART, PWM, ADC, and GPIO with interrupts via <code>Greybus</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
BeagleConnect™ gateway device
</td>
<td class="hdlist2">
<p>Provides a <code>BeagleConnect™ compatible interface</code> to a host. This could be a built-in interface device or one connected over USB. <em>BeagleConnect™ Freedom</em> can provide this function.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
BeagleConnect™ node device
</td>
<td class="hdlist2">
<p>Utilizes a <code>BeagleConnect™ compatible interface</code> and <mark>TODO</mark></p>
</td>
</tr>
<tr>
<td class="hdlist1">
BeagleConnect™ compatible interface
</td>
<td class="hdlist2">
<p>Immediate plans are to support Bluetooth Low Energy (BLE), 2.4GHz IEEE 802.15.4, and Sub-GHz IEEE 802.15.4 <em>wireless</em> interfaces. A built-in BLE interface is suitable for this at short range, whereas IEEE 802.15.4 is typically significantly better at long ranges. Other <em>wired</em> interfaces, such as <em>CAN</em> and <em>RS-485</em>, are being considered for future <code>BeagleConnect™ gateway device</code> and <code>BeagleConnect™ node device</code> designs.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Greybus
</td>
<td class="hdlist2">
<p><mark>TODO</mark></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>#TODO: Find a place for the following notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The device interfaces get exposed to the host via Greybus BRIDGED_PHY protocol</p>
</li>
<li>
<p>The I2C bus is probed for a an identifier EEPROM and appropriate device drivers are loaded on the host</p>
</li>
<li>
<p>Unsupported Click Boards connected are exposed via userspace drivers on the host for development</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="whats-different"><a class="anchor" href="#whats-different"></a>What&#8217;s different</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So, in summary, what is so different with this approach?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No microcontroller code development is required by users</p>
</li>
<li>
<p>Userspace drivers make rapid prototyping really easy</p>
</li>
<li>
<p>Kernel drivers makes the support code collaborative parts of the Linux kernel, rather than cut-and-paste</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="development" class="sect0"><a class="anchor" href="#development"></a>Develop for BeagleConnect™ Freedom with Zephyr</h1>
<div class="paragraph">
<p>Developing directly in Zephyr will not be ultimately required for end-users who won&#8217;t touch the firmware running on BeagleConnect™ Freedom and will instead use the BeagleConnect™ Greybus functionality, but is important for early adopters as well as people looking to extend the functionality of the open source design. If you are one of those people, this is a good place to get started.</p>
</div>
<div class="sect1">
<h2 id="equipment"><a class="anchor" href="#equipment"></a>Equipment to begin development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many options, but let&#8217;s get started with one recommended set for the beta users.</p>
</div>
<div class="sect2">
<h3 id="truerequired"><a class="anchor" href="#truerequired"></a>Required</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#beta-kit">BeagleConnect™ Freedom beta kit</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.seeedstudio.com/BeagleBone-Green-Gateway/">Seeed Studio BeagleBone® Green Gateway</a></p>
</li>
<li>
<p>3x BeagleConnect™ Freedom board, antenna, U.FL to SMA cable, SMA antenna and USB Type-A to Type-C cable</p>
</li>
<li>
<p>1x <a href="https://www.mikroe.com/click">MikroE</a> ID Click</p>
</li>
</ul>
</div>
</li>
<li>
<p>microSD card (6GB or larger)</p>
</li>
<li>
<p>microSD card programmer</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="truerecommended"><a class="anchor" href="#truerecommended"></a>Recommended</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://smile.amazon.com/TMEZON-Power-Adapter-Supply-2-1mm/dp/B00Q2E5IXW">12V power brick</a></p>
</li>
<li>
<p><a href="https://smile.amazon.com/Converter-Terminated-Galileo-BeagleBone-Minnowboard/dp/B06ZYPLFNB">USB to TTL 3.3V UART adapter</a></p>
</li>
<li>
<p>Ethernet cable and Internet connection</p>
</li>
<li>
<p>2x USB power adapters</p>
</li>
<li>
<p><a href="https://www.mikroe.com/weather-click">BME280-based Weather Click</a></p>
</li>
<li>
<p><a href="https://www.mikroe.com/air-quality-2-click">iAQ-Core-based Air Quality 2 Click</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="trueoptional"><a class="anchor" href="#trueoptional"></a>Optional</h3>
<div class="ulist">
<ul>
<li>
<p>x86_64 computer running Ubuntu 20.04.3 LTS</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueinstall-the-latest-software-image-for-beaglebone-green-gateway"><a class="anchor" href="#trueinstall-the-latest-software-image-for-beaglebone-green-gateway"></a>Install the latest software image for BeagleBone Green Gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Download and install the Debian Linux operating system image for the Seeed BeagleBone® Green Gateway host.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the special mikroBUS/Greybus BeagleBoard.org Debian image from <a href="https://rcn-ee.net/rootfs/debian-mikrobus-armhf/">here</a>. Scroll down to find the most recent directory and select the file beginning with <strong>bone-</strong> and ending with <strong>.img.xz</strong>. Today that file is <strong>bone-debian-11.2-iot-mikrobus-armhf-2022-03-04-4gb.img.xz</strong>.</p>
</li>
<li>
<p>Load this image to a microSD card using a tool like <a href="https://www.balena.io/etcher/">Etcher</a>.</p>
</li>
<li>
<p>Insert the microSD card into the Green Gateway.</p>
</li>
<li>
<p>Power BeagleBone Green Gateway via the 12V barrel jack.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>#TODO: describe how to know it is working</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truelog-into-beaglebone-green-gateway"><a class="anchor" href="#truelog-into-beaglebone-green-gateway"></a>Log into BeagleBone Green Gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These instructions assume an x86_64 computer runing Ubuntu 20.04.3 LTS, but any computer can be used to connect to your BeagleBone Green Gateway.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log onto the Seeed BeagleBone® Green Gateway using <code>ssh</code>.</p>
<div class="ulist">
<ul>
<li>
<p>We need IP address, Username, and Password to connect to the device.</p>
</li>
<li>
<p>The default IP for the BeagleBone hardware is <code>192.168.7.2</code></p>
</li>
<li>
<p>The default Username is <code>debian</code> &amp; Password is <code>temppwd</code></p>
</li>
<li>
<p>To connect you can simply type <code>$ ssh debian@192.168.7.2</code> and when asked for password just type <code>temppwd</code>.</p>
</li>
<li>
<p>Congratulations, You are now connected to the device!</p>
</li>
</ul>
</div>
</li>
<li>
<p>Connect to the <a href="https://forum.beagleboard.org/t/debian-11-x-bullseye-monthly-snapshots/31280">WiFi</a></p>
<div class="ulist">
<ul>
<li>
<p>Execute <code>sudo nano /etc/wpa_supplicant/wpa_supplicant-wlan0.conf</code> and provide the password <code>temppwd</code> to edit the configuration file for the WiFi connection.</p>
</li>
<li>
<p>Now edit the the file (shown below) under the <code>network={ &#8230;&#8203; }</code> section you can set you <code>ssid</code> (WiFi name) and <code>psk</code> (Wifi Password).</p>
<div class="literalblock">
<div class="content">
<pre>ctrl_interface=DIR=/run/wpa_supplicant GROUP=netdev
update_config=1
#country=IN
network={
        ssid="WiFi Name"
        psk="WiFi Password"
}</pre>
</div>
</div>
</li>
<li>
<p>Now save the file with <code>CTRL+O</code> and exit with <code>CTRL+X</code>.</p>
</li>
<li>
<p>Check if the connection is established by executing <code>$ ping 8.8.8.8</code> you should see something like shown below.</p>
<div class="literalblock">
<div class="content">
<pre>debian@BeagleBone:~$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=118 time=10.5 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=118 time=5.72 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=118 time=6.13 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=118 time=6.11 ms
...</pre>
</div>
</div>
</li>
<li>
<p>If everything goes will, you are ready to update your system and install new applications for beagleconnect.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are facing some issue during boot then you can try debuging the boot session with a USB to serial interface cable such as those made by <a href="https://www.digikey.com/short/cfjmdbdd">FTDI</a> plugged into J10 with the black wire of the FTDI cable toward the Ethernet connector. Application like putty/mimicom can be used to make the connection estibleshment procedure easy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>#TODO: Simplify and elaborate on this section</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sdk"><a class="anchor" href="#sdk"></a>Install Zephyr development tools on BeagleBone Green Gateway</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Update the system.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo apt update</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Install all BeagleConnect™ management software.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo apt install -y \
	beagleconnect beagleconnect-msp430 \
	git vim \
	build-essential \
	cmake ninja-build gperf \
	ccache dfu-util device-tree-compiler \
	make gcc libsdl2-dev \
	libxml2-dev libxslt-dev libssl-dev libjpeg62-turbo-dev \
	gcc-arm-none-eabi libnewlib-arm-none-eabi \
	libtool-bin pkg-config autoconf automake libusb-1.0-0-dev \
	python3-dev python3-pip python3-setuptools python3-tk python3-wheel</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">echo "export PATH=$PATH:$HOME/.local/bin" &gt;&gt; $HOME/.bashrc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">source $HOME/.bashrc</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Reboot</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo reboot</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Install BeagleConnect™ flashing software</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">pip3 install -U west</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Reboot</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo reboot</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Download and setup Zephyr for BeagleConnect™</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cd</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">west init -m https://github.com/jadonk/zephyr --mr bcf-sdk-0.0.5 bcf-zephyr</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cd $HOME/bcf-zephyr</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">west update</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">west zephyr-export</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">pip3 install -r zephyr/scripts/requirements-base.txt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">echo "export CROSS_COMPILE=/usr/bin/arm-none-eabi-" &gt;&gt; $HOME/.bashrc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">echo "export ZEPHYR_BASE=$HOME/bcf-zephyr/zephyr" &gt;&gt; $HOME/.bashrc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">echo "export PATH=$HOME/bcf-zephyr/zephyr/scripts:$PATH" &gt;&gt; $HOME/.bashrc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">echo "export BOARD=beagleconnect_freedom" &gt;&gt; $HOME/.bashrc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">source $HOME/.bashrc</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truebuild-applications-for-beagleconnect-freedom-on-beaglebone-green-gateway"><a class="anchor" href="#truebuild-applications-for-beagleconnect-freedom-on-beaglebone-green-gateway"></a>Build applications for BeagleConnect Freedom on BeagleBone Green Gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now you can build various Zephyr applications</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cd $HOME/bcf-zephyr</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">west build -d build/blinky zephyr/samples/basic/blinky</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">west build -d build/sensortest zephyr/samples/boards/beagle_bcf/sensortest -- -DOVERLAY_CONFIG=overlay-subghz.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">west build -d build/wpanusb modules/lib/wpanusb_bc -- -DOVERLAY_CONFIG=overlay-subghz.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">west build -d build/bcfserial modules/lib/wpanusb_bc -- -DOVERLAY_CONFIG=overlay-bcfserial.conf -DDTC_OVERLAY_FILE=bcfserial.overlay</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">west build -d build/greybus modules/lib/greybus/samples/subsys/greybus/net -- -DOVERLAY_CONFIG=overlay-802154-subg.conf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueflash-applications-to-beagleconnect-freedom-from-beaglebone-green-gateway"><a class="anchor" href="#trueflash-applications-to-beagleconnect-freedom-from-beaglebone-green-gateway"></a>Flash applications to BeagleConnect Freedom from BeagleBone Green Gateway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>And then you can flash the BeagleConnect Freedom boards over USB</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cd $HOME/bcf-zephyr
cc2538-bsl.py build/blinky</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truedebug-applications-over-the-serial-terminal"><a class="anchor" href="#truedebug-applications-over-the-serial-terminal"></a>Debug applications over the serial terminal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>#TODO</p>
</div>
</div>
</div>
<h1 id="work-in-progress" class="sect0"><a class="anchor" href="#work-in-progress"></a>Work in progress</h1>
<div class="paragraph">
<p>To understand a bit more about how the BeagleConnect™ Greybus stack is being built, this section helps describe the development currently in progress and the principles of operation.</p>
</div>
<div class="sect1">
<h2 id="background"><a class="anchor" href="#background"></a>Background</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="https://github.com/beagleboard/beagleconnect/blob/master/docs/SoftwareProp.PNG?raw=true" alt="Software Proposition"></span> BeagleConnect™ uses Greybus and updated Click Boards with
identifiers to eliminate the need to add and manually configure devices
added onto the Linux system.</p>
</div>
<div class="sect2">
<h3 id="high-level"><a class="anchor" href="#high-level"></a>High-level</h3>
<div class="ulist">
<ul>
<li>
<p>For Linux nerds: Think of BeagleConnect™ as
<a href="https://en.wikipedia.org/wiki/6LoWPAN">6LoWPAN</a> over
<a href="https://en.wikipedia.org/wiki/IEEE_802.15.4">802.15.4</a>-based
<a href="https://kernel-recipes.org/en/2015/talks/an-introduction-to-greybus/">Greybus</a>
(instead of Unipro as used by Project Ara), where every BeagleConnect™
board shows up as new SPI, I2C, UART, PWM, ADC, and GPIO controllers
that can now be probed to load drivers for the sensors or whatever is
connected to them. (Proof of concept of Greybus over TCP/IP:
<a href="https://www.youtube.com/watch?v=7H50pv-4YXw" class="bare">https://www.youtube.com/watch?v=7H50pv-4YXw</a>)</p>
</li>
<li>
<p>For MCU folks: Think of BeagleConnect™ as a
<a href="https://github.com/firmata/protocol">Firmata</a>-style firmware load that
exposes the interfaces for remote access over a secured wireless
network. However, instead of using host software that knows how to speak
the Firmata protocol, the Linux kernel speaks the slightly similar
Greybus protocol to the MCU and exposes the device generically to users
using a Linux kernel driver. Further, the Greybus protocol is spoken
over <a href="https://en.wikipedia.org/wiki/6LoWPAN">6LoWPAN</a> on
<a href="https://en.wikipedia.org/wiki/IEEE_802.15.4">802.15.4</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="software-architecture"><a class="anchor" href="#software-architecture"></a>Software architecture</h3>
<div class="paragraph">
<p><span class="image"><img src="https://github.com/beagleboard/beagleconnect/blob/master/docs/bcf_block_diagram.svg?raw=true" alt="Block Diagram"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="todo-items"><a class="anchor" href="#todo-items"></a>TODO items</h3>
<div class="ulist">
<ul>
<li>
<p>Linux kernel driver</p>
</li>
<li>
<p>Provisioning</p>
</li>
<li>
<p>Firmware for host CC13x</p>
</li>
<li>
<p>Firmware for device CC13x</p>
</li>
<li>
<p>Click Board drivers and device tree formatted metadata for 100 or so
Click Boards</p>
</li>
<li>
<p>Click Board plug-ins for node-red for the same 100 or so Click Boards</p>
</li>
<li>
<p>BeagleConnect™ Freedom System Reference Manual and FAQs</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="associated-pre-work"><a class="anchor" href="#associated-pre-work"></a>Associated pre-work</h3>
<div class="ulist">
<ul>
<li>
<p>Click Board support for Node-RED can be executed with native
connections on PocketBeagle+TechLab and BeagleBone Black with mikroBUS
Cape</p>
</li>
<li>
<p>Device tree fragments and driver updates can be provided via
<a href="https://bbb.io/click" class="bare">https://bbb.io/click</a></p>
</li>
<li>
<p>The Kconfig style provisioning can be implemented for those solutions,
which will require a reboot. We need to centralize edits to
/boot/uEnv.txt to be programmatic. As I think through this, I don&#8217;t
think BeagleConnect is impacted, because the Greybus-style discovery
along with Click EEPROMS will eliminate any need to edit /boot/uEnv.txt.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="user-experience-concerns"><a class="anchor" href="#user-experience-concerns"></a>User experience concerns</h3>
<div class="ulist">
<ul>
<li>
<p>Make sure no reboots are required</p>
</li>
<li>
<p>Plugging BeagleConnect into host should trigger host configuration</p>
</li>
<li>
<p>Click EEPROMs should trigger loading whatever drivers are needed and
provisioning should load any new drivers</p>
</li>
<li>
<p>Userspace (spidev, etc.) drivers should unload cleanly when 2nd phase
provisioning is completed</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="demo-1" class="sect0"><a class="anchor" href="#demo-1"></a>BeagleConnect™ Greybus demo using BeagleConnect™ Freedom</h1>
<div class="paragraph">
<p>BeagleConnect™ Freedom runs a subGHz IEEE 802.15.4 network. This BeagleConnect™ Greybus demo shows how to interact with GPIO, I2C and mikroBUS add-on boards remotely connected over a BeagleConnect™ Freedom.</p>
</div>
<div class="paragraph">
<p>This section starts with the steps required to use
<a href="https://en.wikipedia.org/wiki/Linux">Linux</a> embedded computer (<a href="https://wiki.seeedstudio.com/BeagleBone-Green-Gateway/">BeagleBone Green Gateway</a>) and the
<a href="https://lwn.net/Articles/715955/">Greybus</a> protocol, over an IEEE
802.15.4 wireless link, to blink an LED on a
<a href="https://zephyrproject.org">Zephyr</a> device.</p>
</div>
<div class="sect1">
<h2 id="trueintroduction"><a class="anchor" href="#trueintroduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="truewhy"><a class="anchor" href="#truewhy"></a>Why??</h3>
<div class="paragraph">
<p>Good question. Blinking an LED is kind of the
<a href="https://en.wikipedia.org/wiki/%22Hello,_World!%22_program">Hello, World</a>
of the hardware community. In this case, we’re less interested in the
mechanics of switching a GPIO to drive some current through an LED and
more interested in how that happens with the
<a href="https://en.wikipedia.org/wiki/Internet_of_things">Internet of Things
(IoT)</a>.</p>
</div>
<div class="paragraph">
<p>There are several existing network and application layers that are
driven by corporate heavyweights and industry consortiums, but
relatively few that are community driven and, more specifically, even
fewer that have the ability to integrate so tightly with the Linux
kernel.</p>
</div>
<div class="paragraph">
<p>The goal here is to provide a community-maintained, developer-friendly,
and open-source protocol for the Internet of Things using the Greybus
Protocol, and blinking an LED using Greybus is the simplest
proof-of-concept for that. All that is required is a reliable transport.</p>
</div>
</div>
<div class="sect2">
<h3 id="truehistory"><a class="anchor" href="#truehistory"></a>History</h3>
<div class="paragraph">
<p>There are a few technologies at the core of this demonstration, and far
too much background information to describe adequately here, so they are
simply listed below for brevity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Project_Ara">Project Ara</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/IPv6">IPv6</a> (via
<a href="https://en.wikipedia.org/wiki/6LoWPAN">6LoWPAN</a>)</p>
</li>
<li>
<p><a href="https://zephyrproject.org">Zephyr</a> support for
<a href="https://docs.zephyrproject.org/latest/reference/networking/ieee802154.html">IEEE
802.15.4</a></p>
</li>
<li>
<p><a href="https://youtu.be/UzRq8jAHAxU">Greybus</a> originally from
<a href="https://youtu.be/UzRq8jAHAxU">Project Ara</a></p>
</li>
<li>
<p><a href="https://youtu.be/7H50pv-4YXw">Using Greybus for IoT</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In short, Greybus is an application layer protocol that can be described
as a ``bus transport'' in that it conveys bus-specific messages back and
forth between Linux and a connected device. The physical bus is attached
to the connected device, which could be running Linux or a variety of
Real-Time Operating Systems. Meanwhile, on the Linux side, a virtual bus
is created corresponding to the physical bus on the connected device. To
the user, this virtual bus (be it /dev/gpiochip0, /dev/i2c5, etc)
appears and functions exactly the same. Greybus is the protocol used to
exchange bus-specific messages and data between Linux and the connected
device.</p>
</div>
<div class="paragraph">
<p>The major advantage there is that drivers can be well maintained in
Linux rather than buried in microcontroller firmware.</p>
</div>
<div class="paragraph">
<p>Greybus currently supports several busses, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>USB</p>
</li>
<li>
<p>I2C</p>
</li>
<li>
<p>GPIO</p>
</li>
<li>
<p>PWM</p>
</li>
<li>
<p>SPI</p>
</li>
<li>
<p>UART</p>
</li>
<li>
<p>SDIO</p>
</li>
<li>
<p>Camera (V4L)</p>
</li>
<li>
<p>LED (with various programmability)</p>
</li>
<li>
<p>AUDIO (I2S)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>#TODO: The agenda for the above falls a bit short of BeagleConnect</p>
</div>
</div>
<div class="sect2">
<h3 id="truehardware-requirements"><a class="anchor" href="#truehardware-requirements"></a>Hardware requirements</h3>
<div class="paragraph">
<p>See the <a href="#Equipment">[Equipment]</a> section for hardware requirements.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truerunning-the-demo"><a class="anchor" href="#truerunning-the-demo"></a>Running the demo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>#TODO: Fill in some details for new embedded Linux users</p>
</div>
<div class="paragraph">
<p>#TODO: Arrange demo in order of <em>fast success</em> to <em>greater understanding</em></p>
</div>
<div class="sect2">
<h3 id="trueinstall-the-latest-software-image"><a class="anchor" href="#trueinstall-the-latest-software-image"></a>Install the latest software image</h3>
<div class="paragraph">
<p>Download and install the Debian Linux operating system image for the
Seeed BeagleBone® Green Gateway host.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the special mikroBUS/Greybus BeagleBoard.org Debian image from
<a href="https://rcn-ee.net/rootfs/debian-mikrobus-armhf/">here</a>.
Pick the most recent directory and select the file beginning with <strong>bone-</strong> and ending with <strong>.img.xz</strong>.
Today that file is <strong>bone-debian-11.2-iot-mikrobus-armhf-2022-03-04-4gb.img.xz</strong>.</p>
</li>
<li>
<p>Load this image to a microSD card using a tool like <a href="https://www.balena.io/etcher/">Etcher</a>.</p>
</li>
<li>
<p>Insert the microSD card into the Green Gateway.</p>
</li>
<li>
<p>Power the Green Gateway via the 12V barrel jack.</p>
</li>
<li>
<p>Log onto the Seeed BeagleBone® Green Gateway using <code>ssh</code> or, with a serial to USB cable such as those made by FTDI[<a href="https://www.digikey.com/short/cfjmdbdd" class="bare">https://www.digikey.com/short/cfjmdbdd</a>] plugged into J10 with the black wire of the FTDI cable toard the Ethernet connector.  To use <code>ssh</code>, you will have to know the Green Gateway&#8217;s IP address that can be found from your router.</p>
</li>
<li>
<p>(If using WiFi) Use the <code>connmanctl</code> tool to gain an Internet connection.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="trueflash-beagleconnect-freedom-gateway-device"><a class="anchor" href="#trueflash-beagleconnect-freedom-gateway-device"></a>Flash BeagleConnect™ Freedom <strong>gateway</strong> device</h3>
<div class="paragraph">
<p>Comamnd-line instructions below are to be issued into the BeagleBone® Green Gateway terminal, either via <code>ssh</code> or the serial console.</p>
</div>
<div class="paragraph">
<p>On the newly imaged BeagleBone® Green Gateway board:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect (or reconnect) a BeagleConnect™ Freedom board over USB</p>
</li>
<li>
<p><code>cc2538-bsl.py /usr/share/beagleconnect/cc1352/wpanusb_beagleconnect.bin /dev/ttyACM0</code>
<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</li>
<li>
<p>After it finishes programming successfully, reconnect the BeagleConnect Freedom board over USB</p>
</li>
<li>
<p>Test that the driver loaded and is talking to the newly added gateway radio</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">debian@beaglebone:~$ iwpan wpan0 info
Interface wpan0
        ifindex 10
        wpan_dev 0x200000001
        extended_addr 0x5a4f745eb7beac7f
        short_addr 0xffff
        pan_id 0xffff
        type node
        max_frame_retries 3
        min_be 3
        max_be 5
        max_csma_backoffs 4
        lbt 0
        ackreq_default 0</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="truetest-gateway-using-pre-programmed-node-firmware"><a class="anchor" href="#truetest-gateway-using-pre-programmed-node-firmware"></a>Test gateway using pre-programmed node firmware</h3>
<div class="paragraph">
<p>By default, the beta boards ship with a debug sensor broadcast per <a href="https://gist.github.com/Pillar1989/c579b789e38e856cde16e77345932ac4">sensortest-main.c</a>. You can use this to further test your gateway.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Power a BeagleConnect Freedom that has not yet been programmed via a USB power source, not
the BeagleBone Green Gateway. You&#8217;ll hear a click every 1-2 seconds along with seeing 4 of the
LEDs turn off and on.</p>
</li>
<li>
<p>In an isolated terminal window, <code>sudo beagleconnect-start-gateway</code></p>
</li>
<li>
<p><code>sensortest-rx.py</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Every 1-2 minutes, you should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">('fe80::3111:7a22:4b:1200%lowpan0', 52213, 0, 13)  '2l:7.79;'
('fe80::3111:7a22:4b:1200%lowpan0', 52213, 0, 13)  '4h:43.75;4t:23.11;'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value after "2l:" is the amount of light in lux. The value after "4h:" is the relative humidity and after "4t:" is the temperature in Celcius.</p>
</div>
</div>
<div class="sect2">
<h3 id="trueflash-beagleconnect-freedom-node-device-with-greybus-firmware"><a class="anchor" href="#trueflash-beagleconnect-freedom-node-device-with-greybus-firmware"></a>Flash BeagleConnect™ Freedom <strong>node</strong> device with Greybus firmware</h3>
<div class="paragraph">
<p>#TODO: How can we add a step in here to show the network is connected without needing <code>gbridge</code> to be fully functional?</p>
</div>
<div class="paragraph">
<p>Do this from the BeagleBone® Green Gateway board that was previously used to program the BeagleConnect™ Freedom <strong>gateway</strong> device:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disconnect the BeagleConnect™ Freedom <strong>gateway</strong> device</p>
</li>
<li>
<p>Connect a new BeagleConnect™ Freedom board via USB</p>
</li>
<li>
<p><code>sudo systemctl stop lowpan.service</code></p>
</li>
<li>
<p><code>cc2538-bsl.py /usr/share/beagleconnect/cc1352/greybus_mikrobus_beagleconnect.bin /dev/ttyACM0</code>
<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</li>
<li>
<p>After it finishes programming successfully, disconnect the BeagleConnect Freedom node device</p>
</li>
<li>
<p>Power the newly programmed BeagleConnect Freedom <strong>node</strong> device from an alternate USB power source</p>
</li>
<li>
<p>Reconnect the BeagleConnect Freedom <strong>gateway</strong> device to the BeagleBone Green Gateway</p>
</li>
<li>
<p><code>sudo systemctl start lowpan.service</code></p>
</li>
<li>
<p><code>sudo beagleconnect-start-gateway</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="sh" class="language-sh hljs">debian@beaglebone:~$ sudo beagleconnect-start-gateway
[sudo] password for debian:
setting up wpanusb gateway for IEEE 802154 CHANNEL 1(906 Mhz)
ping6: Warning: source address might be selected on device other than lowpan0.
PING 2001:db8::1(2001:db8::1) from ::1 lowpan0: 56 data bytes
64 bytes from 2001:db8::1: icmp_seq=2 ttl=64 time=185 ms
64 bytes from 2001:db8::1: icmp_seq=3 ttl=64 time=40.9 ms
64 bytes from 2001:db8::1: icmp_seq=4 ttl=64 time=40.9 ms
64 bytes from 2001:db8::1: icmp_seq=5 ttl=64 time=40.6 ms

--- 2001:db8::1 ping statistics ---
5 packets transmitted, 4 received, 20% packet loss, time 36ms
rtt min/avg/max/mdev = 40.593/76.796/184.799/62.356 ms
debian@beaglebone:~$ iio_info
Library version: 0.19 (git tag: v0.19)
Compiled with backends: local xml ip usb serial
IIO context created with local backend.
Backend version: 0.19 (git tag: v0.19)
Backend description string: Linux beaglebone 5.14.18-bone20 #1buster PREEMPT Tue Nov 16 20:47:19 UTC 2021 armv7l
IIO context has 1 attributes:
	local,kernel: 5.14.18-bone20
IIO context has 3 devices:
	iio:device0: TI-am335x-adc.0.auto (buffer capable)
		8 channels found:
			voltage0:  (input, index: 0, format: le:u12/16&gt;&gt;0)
			1 channel-specific attributes found:
				attr  0: raw value: 1412
			voltage1:  (input, index: 1, format: le:u12/16&gt;&gt;0)
			1 channel-specific attributes found:
				attr  0: raw value: 2318
			voltage2:  (input, index: 2, format: le:u12/16&gt;&gt;0)
			1 channel-specific attributes found:
				attr  0: raw value: 2631
			voltage3:  (input, index: 3, format: le:u12/16&gt;&gt;0)
			1 channel-specific attributes found:
				attr  0: raw value: 817
			voltage4:  (input, index: 4, format: le:u12/16&gt;&gt;0)
			1 channel-specific attributes found:
				attr  0: raw value: 881
			voltage5:  (input, index: 5, format: le:u12/16&gt;&gt;0)
			1 channel-specific attributes found:
				attr  0: raw value: 0
			voltage6:  (input, index: 6, format: le:u12/16&gt;&gt;0)
			1 channel-specific attributes found:
				attr  0: raw value: 0
			voltage7:  (input, index: 7, format: le:u12/16&gt;&gt;0)
			1 channel-specific attributes found:
				attr  0: raw value: 1180
		2 buffer-specific attributes found:
				attr  0: data_available value: 0
				attr  1: watermark value: 1
	iio:device1: hdc2010
		3 channels found:
			humidityrelative:  (input)
			3 channel-specific attributes found:
				attr  0: peak_raw value: 52224
				attr  1: raw value: 52234
				attr  2: scale value: 1.525878906
			current:  (output)
			2 channel-specific attributes found:
				attr  0: heater_raw value: 0
				attr  1: heater_raw_available value: 0 1
			temp:  (input)
			4 channel-specific attributes found:
				attr  0: offset value: -15887.515151
				attr  1: peak_raw value: 25600
				attr  2: raw value: 25628
				attr  3: scale value: 2.517700195
	iio:device2: opt3001
		1 channels found:
			illuminance:  (input)
			2 channel-specific attributes found:
				attr  0: input value: 79.040000
				attr  1: integration_time value: 0.800000
		2 device-specific attributes found:
				attr  0: current_timestamp_clock value: realtime

				attr  1: integration_time_available value: 0.1 0.8
debian@beaglebone:~$ dmesg | grep -e mikrobus -e greybus
[  100.491253] greybus 1-2.2: Interface added (greybus)
[  100.491294] greybus 1-2.2: GMP VID=0x00000126, PID=0x00000126
[  100.491306] greybus 1-2.2: DDBL1 Manufacturer=0x00000126, Product=0x00000126
[  100.737637] greybus 1-2.2: excess descriptors in interface manifest
[  102.475168] mikrobus:mikrobus_port_gb_register: mikrobus gb_probe , num cports= 2, manifest_size 192
[  102.475206] mikrobus:mikrobus_port_gb_register: protocol added 3
[  102.475214] mikrobus:mikrobus_port_gb_register: protocol added 2
[  102.475239] mikrobus:mikrobus_port_register: registering port mikrobus-1
[  102.475400] mikrobus_manifest:mikrobus_state_get: mikrobus descriptor not found
[  102.475417] mikrobus_manifest:mikrobus_manifest_attach_device: parsed device 1, driver=opt3001, protocol=3, reg=44
[  102.494516] mikrobus_manifest:mikrobus_manifest_attach_device: parsed device 2, driver=hdc2010, protocol=3, reg=41
[  102.494567] mikrobus_manifest:mikrobus_manifest_parse:  (null) manifest parsed with 2 devices
[  102.494592] mikrobus mikrobus-1: registering device : opt3001
[  102.495096] mikrobus mikrobus-1: registering device : hdc2010
debian@beaglebone:~$</code></pre>
</div>
</div>
<div class="paragraph">
<p>#TODO: update the below for the built-in sensors</p>
</div>
<div class="paragraph">
<p>#TODO: can we also handle the case where these sensors are included and recommend them? Same firmware?</p>
</div>
<div class="paragraph">
<p>#TODO: the current demo is for the built-in sensors, not the Click boards mentioned below</p>
</div>
<div class="paragraph">
<p>Currently only a limited number of add-on boards have been tested to work over Greybus, simple add-on
boards without interrupt requirement are the ones that work currently.  The example is for
Air Quality 2 Click and Weather Click attached to the mikroBUS ports on the device side.</p>
</div>
<div class="paragraph">
<p>/var/log/gbridge will have the gbridge log, and if the mikroBUS port has been instantiated successfully the kernel log will show the devices probe messages:</p>
</div>
<div class="paragraph">
<p>#TODO: this log needs to be updated</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">greybus 1-2.2: GMP VID=0x00000126, PID=0x00000126
greybus 1-2.2: DDBL1 Manufacturer=0x00000126, Product=0x00000126
greybus 1-2.2: excess descriptors in interface manifest
mikrobus:mikrobus_port_gb_register: mikrobus gb_probe , num cports= 3, manifest_size 252
mikrobus:mikrobus_port_gb_register: protocol added 11
mikrobus:mikrobus_port_gb_register: protocol added 3
mikrobus:mikrobus_port_gb_register: protocol added 2
mikrobus:mikrobus_port_register: registering port mikrobus-0
mikrobus_manifest:mikrobus_manifest_attach_device: parsed device 1, driver=bme280, protocol=3, reg=76
mikrobus_manifest:mikrobus_manifest_attach_device: parsed device 2, driver=ams-iaq-core, protocol=3, reg=5a
mikrobus_manifest:mikrobus_manifest_parse:  Greybus Service Sample Application manifest parsed with 2 devices
mikrobus mikrobus-0: registering device : bme280
mikrobus mikrobus-0: registering device : ams-iaq-core</code></pre>
</div>
</div>
<div class="paragraph">
<p>#TODO: bring in the GPIO toggle and I2C explorations for greater understanding</p>
</div>
</div>
<div class="sect2">
<h3 id="trueflashing-via-a-linux-host"><a class="anchor" href="#trueflashing-via-a-linux-host"></a>Flashing via a Linux Host</h3>
<div class="paragraph">
<p>If flashing the Freedom board via the BeagleBone fails here&#8217;s a trick you can try to flash from a Linux host.</p>
</div>
<div class="paragraph">
<p>Use <code>sshfs</code> to mount the Bone&#8217;s files on the Linux host.  This assumes the Bone is plugged in the the USB
and appears at <code>192.168.7.2</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">host$ cd
host$ sshfs 192.168.7.2:/ bone
host$ cd bone; ls
bin   dev  home    lib         media  opt   root  sbin  sys  usr
boot  etc  ID.txt  lost+found  mnt    proc  run   srv   tmp  var
host$ ls /dev/ttyACM*
/dev/ttyACM1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Bone&#8217;s files now appear as local files.  Notice there is already a
<code>/dev/ACM</code> appearing.  Now plug the Connect into the Linux host&#8217;s USB port
and run the command again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">host$ ls /dev/ttyACM*
/dev/ttyACM0  /dev/ttyACM1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>/dev/ttyASM</code> that just appeared is the one associated with the Connect.
In my case it&#8217;s <code>/dev/ttyACM0</code>.  That&#8217;s what I&#8217;ll use in this example.</p>
</div>
<div class="paragraph">
<p>Now change directories to where the binaries are and load:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">host$ cd ~/bone/usr/share/beagleconnect/cc1352;ls
greybus_mikrobus_beagleconnect.bin     sensortest_beagleconnect.dts
greybus_mikrobus_beagleconnect.config  wpanusb_beagleconnect.bin
greybus_mikrobus_beagleconnect.dts     wpanusb_beagleconnect.config
sensortest_beagleconnect.bin           wpanusb_beagleconnect.dts
sensortest_beagleconnect.config

host$ ~/bone/usr/bin/cc2538-bsl.py sensortest_beagleconnect.bin /dev/ttyACM0
8-bsl.py sensortest_beagleconnect.bin /dev/ttyACM0
Opening port /dev/ttyACM0, baud 50000
Reading data from sensortest_beagleconnect.bin
Cannot auto-detect firmware filetype: Assuming .bin
Connecting to target...
CC1350 PG2.0 (7x7mm): 352KB Flash, 20KB SRAM, CCFG.BL_CONFIG at 0x00057FD8
Primary IEEE Address: 00:12:4B:00:22:7A:10:46
    Performing mass erase
Erasing all main bank flash sectors
    Erase done
Writing 360448 bytes starting at address 0x00000000
Write 104 bytes at 0x00057F988
    Write done
Verifying by comparing CRC32 calculations.
    Verified (match: 0x0f6bdf0f)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you are ready to continue the instructions above after the cc2528 command.</p>
</div>
<div class="sect3">
<h4 id="truetrying-for-different-add-on-boards"><a class="anchor" href="#truetrying-for-different-add-on-boards"></a>Trying for different add-on boards</h4>
<div class="paragraph">
<p>See <a href="https://github.com/vaishnav98/greybus-for-zephyr/tree/mikrobus#trying-out-different-add-on-boardsdevices-over-mikrobus">mikroBUS over Greybus</a> for trying out the same example for different mikroBUS add-on boards/ on-board devices.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueobserve-the-node-device"><a class="anchor" href="#trueobserve-the-node-device"></a>Observe the node device</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Connect BeagleConnect Freedom node device to an Ubuntu laptop to observe the Zephyr console.</p>
</div>
<div class="sect2">
<h3 id="trueconsole-tio"><a class="anchor" href="#trueconsole-tio"></a>Console (<code>tio</code>)</h3>
<div class="paragraph">
<p>In order to see diagnostic messages or to run certain commands on the
Zephyr device we will require a terminal open to the device console. In
this case, we use <a href="https://tio.github.io/">tio</a> due how its usage
simplifies the instructions.</p>
</div>
<div class="sect3">
<h4 id="trueinstall-tio"><a class="anchor" href="#trueinstall-tio"></a>Install <code>tio</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">sudo apt install -y tio</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truerun-tio"><a class="anchor" href="#truerun-tio"></a>Run <code>tio</code></h4>
<div class="paragraph">
<p>Now, we’ll open a terminal to Zephyr using the newly created setup with
the command below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">tio /dev/ttyACM0</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To exit <code>tio</code> (later), enter <code>ctrl+t, q</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truethe-zephyr-shell"><a class="anchor" href="#truethe-zephyr-shell"></a>The Zephyr Shell</h3>
<div class="paragraph">
<p>After flashing, you should observe the something matching the following
output in <code>tio</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>uart:~$ *** Booting Zephyr OS build 9c858c863223  ***
[00:00:00.009,735] &lt;inf&gt; greybus_transport_tcpip: CPort 0 mapped to TCP/IP port 4242
[00:00:00.010,131] &lt;inf&gt; greybus_transport_tcpip: CPort 1 mapped to TCP/IP port 4243
[00:00:00.010,528] &lt;inf&gt; greybus_transport_tcpip: CPort 2 mapped to TCP/IP port 4244
[00:00:00.010,742] &lt;inf&gt; greybus_transport_tcpip: Greybus TCP/IP Transport initialized
[00:00:00.010,864] &lt;inf&gt; greybus_manifest: Registering CONTROL greybus driver.
[00:00:00.011,230] &lt;inf&gt; greybus_manifest: Registering GPIO greybus driver.
[00:00:00.011,596] &lt;inf&gt; greybus_manifest: Registering I2C greybus driver.
[00:00:00.011,871] &lt;inf&gt; greybus_service: Greybus is active
[00:00:00.026,092] &lt;inf&gt; net_config: Initializing network
[00:00:00.134,063] &lt;inf&gt; net_config: IPv6 address: 2001:db8::1</pre>
</div>
</div>
<div class="paragraph">
<p>The line beginning with <code>***</code> is the Zephyr boot banner.</p>
</div>
<div class="paragraph">
<p>Lines beginning with a timestamp of the form <code>[H:m:s.us]</code> are Zephyr
kernel messages.</p>
</div>
<div class="paragraph">
<p>Lines beginning with <code>uart:~$</code> indicates that the Zephyr shell is
prompting you to enter a command.</p>
</div>
<div class="paragraph">
<p>From the informational messages shown, we observe the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zephyr is configured with the following
<a href="https://en.wikipedia.org/wiki/Link-local_address#IPv6">link-local IPv6
address</a> <code>fe80::3177:a11c:4b:1200</code></p>
</li>
<li>
<p>It is listening for (both) TCP and UDP traffic on port 4242</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, what the log messages do <em>not</em> show (which will come into play
later), are 2 critical pieces of information:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>The RF Channel</strong>: As you
may have guessed, IEEE 802.15.4 devices are only able to communicate
with each other if they are using the same frequency to transmit and
recieve data. This information is part of the Physical Layer.</p>
</li>
<li>
<p>The
<a href="https://www.silabs.com/community/wireless/proprietary/knowledge-base.entry.html/2019/10/04/connect_tutorial6-ieee802154addressing-rapc">PAN
identifier</a>: IEEE 802.15.4 devices are only be able to communicate with
one another if they use the <em>same</em> PAN ID. This permits multiple
networks (PANs) on the same frequency. This information is part of the
Data Link Layer.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If we type <code>help</code> in the shell and hit <em>Enter</em>, we’re prompted with the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">Please press the &lt;Tab&gt; button to see all available commands.
You can also use the &lt;Tab&gt; button to prompt or auto-complete all commands or its subcommands.
You can try to call commands with &lt;-h&gt; or &lt;--help&gt; parameter for more information.
Shell supports following meta-keys:

Ctrl+a, Ctrl+b, Ctrl+c, Ctrl+d, Ctrl+e, Ctrl+f, Ctrl+k, Ctrl+l, Ctrl+n, Ctrl+p, Ctrl+u, Ctrl+w
Alt+b, Alt+f.
Please refer to shell documentation for more details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>So after hitting <em>Tab</em>, we see that there are several interesting
commands we can use for additional information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">uart:~$
  clear       help        history     ieee802154  log         net
  resize      sample      shell</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="truezephyr-shell-ieee-802-15-4-commands"><a class="anchor" href="#truezephyr-shell-ieee-802-15-4-commands"></a>Zephyr Shell: IEEE 802.15.4 commands</h5>
<div class="paragraph">
<p>Entering <code>ieee802154 help</code>, we see</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">uart:~$ ieee802154 help
ieee802154 - IEEE 802.15.4 commands
Subcommands:
  ack             :&lt;set/1 | unset/0&gt; Set auto-ack flag
  associate       :&lt;pan_id&gt; &lt;PAN coordinator short or long address (EUI-64)&gt;
  disassociate    :Disassociate from network
  get_chan        :Get currently used channel
  get_ext_addr    :Get currently used extended address
  get_pan_id      :Get currently used PAN id
  get_short_addr  :Get currently used short address
  get_tx_power    :Get currently used TX power
  scan            :&lt;passive|active&gt; &lt;channels set n[:m:...]:x|all&gt; &lt;per-channel
                   duration in ms&gt;
  set_chan        :&lt;channel&gt; Set used channel
  set_ext_addr    :&lt;long/extended address (EUI-64)&gt; Set extended address
  set_pan_id      :&lt;pan_id&gt; Set used PAN id
  set_short_addr  :&lt;short address&gt; Set short address
  set_tx_power    :&lt;-18/-7/-4/-2/0/1/2/3/5&gt; Set TX power</code></pre>
</div>
</div>
<div class="paragraph">
<p>We get the missing Channel number (frequency) with the command
<code>ieee802154 get_chan</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">uart:~$ ieee802154 get_chan
Channel 26</code></pre>
</div>
</div>
<div class="paragraph">
<p>We get the missing PAN ID with the command <code>ieee802154 get_pan_id</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">uart:~$ ieee802154 get_pan_id
PAN ID 43981 (0xabcd)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="truezephyr-shell-network-commands"><a class="anchor" href="#truezephyr-shell-network-commands"></a>Zephyr Shell: Network Commands</h5>
<div class="paragraph">
<p>Additionally, we may query the IPv6 information of the Zephyr device.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">uart:~$ net iface

Interface 0x20002b20 (IEEE 802.15.4) [1]
========================================
Link addr : CD:99:A1:1C:00:4B:12:00
MTU       : 125
IPv6 unicast addresses (max 3):
        fe80::cf99:a11c:4b:1200 autoconf preferred infinite
        2001:db8::1 manual preferred infinite
IPv6 multicast addresses (max 4):
        ff02::1
        ff02::1:ff4b:1200
        ff02::1:ff00:1
IPv6 prefixes (max 2):
        &lt;none&gt;
IPv6 hop limit           : 64
IPv6 base reachable time : 30000
IPv6 reachable time      : 16929
IPv6 retransmit timer    : 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we see that the static IPv6 address (<code>2001:db8::1</code>) from
<code>samples/net/sockets/echo_server/prj.conf</code> is present and configured.
While the statically configured IPv6 address is useful, it isn’t 100%
necessary.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truerebuilding-from-source"><a class="anchor" href="#truerebuilding-from-source"></a>Rebuilding from source</h2>
<div class="sectionbody">
<div class="paragraph">
<p>#TODO: revisit everything below here</p>
</div>
<div class="sect2">
<h3 id="trueprerequisites"><a class="anchor" href="#trueprerequisites"></a>Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Zephyr environment is set up according to the
<a href="https://docs.zephyrproject.org/latest/getting_started/index.html">Getting
Started Guide</a></p>
<div class="ulist">
<ul>
<li>
<p>Please use the Zephyr SDK when installing a toolchain above</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://docs.zephyrproject.org/latest/getting_started/index.html#install-a-toolchain">Zephyr
SDK</a> is installed at ~/zephyr-sdk-0.11.2 (any later version should be
fine as well)</p>
</li>
<li>
<p>Zephyr board is connected via USB</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="truecloning-the-repository"><a class="anchor" href="#truecloning-the-repository"></a>Cloning the repository</h3>
<div class="paragraph">
<p>This repository utilizes
<a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">git submodules</a> to keep
track of all of the projects required to reproduce the on-going work.
The instructions here only cover checking out the <code>demo</code> branch which
should stay in a tested state. On-going development will be on the
<code>master</code> branch.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The parent directory <code>~</code> is simply used as a placeholder for testing.
Please use whatever parent directory you see fit.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="trueclone-specific-tag"><a class="anchor" href="#trueclone-specific-tag"></a>Clone specific tag</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">cd ~
git clone --recurse-submodules --branch demo https://github.com/jadonk/beagleconnect</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truezephyr"><a class="anchor" href="#truezephyr"></a>Zephyr</h3>
<div class="sect3">
<h4 id="trueadd-the-fork"><a class="anchor" href="#trueadd-the-fork"></a>Add the Fork</h4>
<div class="paragraph">
<p>For the time being, Greybus must remain outside of the main Zephyr
repository. Currently, it is just in a Zephyr fork, but it should be
converted to a proper
<a href="https://docs.zephyrproject.org/latest/guides/modules.html">Module
(External Project)</a>. This is for a number of reasons, but mainly there
must be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>specifications for authentication and encryption</p>
</li>
<li>
<p>specifications for joining and rejoining wireless networks</p>
</li>
<li>
<p>specifications for discovery</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Therefore, in order to reproduce this example, please run the following.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Open a separate terminal window (<code>Ctrl+Shift+N</code>) or simply create a
new tab in your existing terminal (<code>Ctrl+Shift+T</code>) so that you can see
both or quickly switch between <code>tio</code> and the shell.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">cd ~/beagleconnect/sw/zephyrproject/zephyr
west update</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truebuild-and-flash-zephyr"><a class="anchor" href="#truebuild-and-flash-zephyr"></a>Build and Flash Zephyr</h4>
<div class="paragraph">
<p>Here, we will build and flash the Zephyr
<a href="https://github.com/cfriedt/zephyr/tree/greybus-sockets/samples/subsys/greybus/net">greybus_net
sample</a> to our device.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the file <code>~/.zephyrrc</code> and place the following text inside of it</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">export ZEPHYR_TOOLCHAIN_VARIANT=zephyr
export ZEPHYR_SDK_INSTALL_DIR=~/zephyr-sdk-0.11.2</code></pre>
</div>
</div>
</li>
<li>
<p>Set up the required Zephyr environment variables via</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">source zephyr-env.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Build the project</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">BOARD=cc1352r1_launchxl west build samples/subsys/greybus/net --pristine \
  --build-dir build/greybus_launchpad -- -DCONF_FILE="prj.conf overlay-802154.conf"</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that the last part of the build process looks somewhat like
this:</p>
<div class="literalblock">
<div class="content">
<pre>...
[221/226] Linking C executable zephyr/zephyr_prebuilt.elf
Memory region         Used Size  Region Size  %age Used
           FLASH:      155760 B     360360 B     43.22%
      FLASH_CCFG:          88 B         88 B    100.00%
            SRAM:       58496 B        80 KB     71.41%
        IDT_LIST:         184 B         2 KB      8.98%
[226/226] Linking C executable zephyr/zephyr.elf</pre>
</div>
</div>
</li>
<li>
<p>Flash the firmware to your device using</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">BOARD=cc1352r1_launchxl west flash --build-dir build/greybus_launchpad</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="linux"><a class="anchor" href="#linux"></a>Linux</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you aren&#8217;t comfortable building and installing a Linux kernel on your computer,
you should probably just stop here. I&#8217;ll assume you know the basics of building and installing
a Linux kernel from here on out.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="trueclone-patch-and-build-the-kernel"><a class="anchor" href="#trueclone-patch-and-build-the-kernel"></a>Clone, patch, and build the kernel</h4>
<div class="paragraph">
<p>For this demo, I used the 5.8.4 stable kernel. Also, I&#8217;ve applied the <code>mikrobus</code> kernel
driver, though it isn&#8217;t strictly required for greybus.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Again, <code>~</code> is just used as a placeholder and you can use whatever directory you&#8217;d like.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><mark>TODO: The patches for gb-netlink will eventually be applied here until pushed into mainline.</mark></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">cd ~
git clone --branch v5.8.4 --single-branch git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git
cd linux
git checkout -b v5.8.4-greybus
git am ~/beagleconnect/sw/linux/v2-0001-RFC-mikroBUS-driver-for-add-on-boards.patch
git am ~/beagleconnect/sw/linux/0001-mikroBUS-build-fixes.patch
cp /boot/config-`uname -r` .config
yes "" | make oldconfig
./scripts/kconfig/merge_config.sh .config ~/beagleconnect/sw/linux/mikrobus.config
./scripts/kconfig/merge_config.sh .config ~/beagleconnect/sw/linux/atusb.config
make -j`nproc --all`
sudo make modules_install
sudo make install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reboot and select your new kernel.</p>
</div>
</div>
<div class="sect3">
<h4 id="trueprobe-the-ieee-802-15-4-device-driver"><a class="anchor" href="#trueprobe-the-ieee-802-15-4-device-driver"></a>Probe the IEEE 802.15.4 Device Driver</h4>
<div class="paragraph">
<p>On the Linux machine, make sure the <code>atusb</code> driver is loaded. This should happen automatically
when the adapter is inserted or when the machine is booted while the adapter is installed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">$ dmesg | grep -i ATUSB
[    6.512154] usb 1-1: ATUSB: AT86RF231 version 2
[    6.512492] usb 1-1: Firmware: major: 0, minor: 3, hardware type: ATUSB (2)
[    6.525357] usbcore: registered new interface driver atusb
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We should now be able to see the IEEE 802.15.4 network device by
entering <code>ip a show wpan0</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">$ ip a show wpan0
36: wpan0: &lt;BROADCAST,NOARP,UP,LOWER_UP&gt; mtu 123 qdisc fq_codel state UNKNOWN group default qlen 300
    link/ieee802.15.4 3e:7d:90:4d:8f:00:76:a2 brd ff:ff:ff:ff:ff:ff:ff:ff</code></pre>
</div>
</div>
<div class="paragraph">
<p>But wait, that is not an IP address! It’s the hardware address of the
802.15.4 device. So, in order to associate it with an IP address, we
need to run a couple of other commands (thanks to
<a href="http://wpan.cakelab.org/">cakelab.org</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="trueset-the-802-15-4-physical-and-link-layer-parameters"><a class="anchor" href="#trueset-the-802-15-4-physical-and-link-layer-parameters"></a>Set the 802.15.4 Physical and Link-Layer Parameters</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, get the phy number for the <code>wpan0</code> device</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">$ iwpan list
     wpan_phy phy0
     supported channels:
        page 0: 11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26
      current_page: 0
     current_channel: 26,  2480 MHz
     cca_mode: (1) Energy above threshold
     cca_ed_level: -77
     tx_power: 3
     capabilities:
         iftypes: node,monitor
          channels:
             page 0:
                  [11]  2405 MHz, [12]  2410 MHz, [13]  2415 MHz,
                  [14]  2420 MHz, [15]  2425 MHz, [16]  2430 MHz,
                  [17]  2435 MHz, [18]  2440 MHz, [19]  2445 MHz,
                  [20]  2450 MHz, [21]  2455 MHz, [22]  2460 MHz,
                  [23]  2465 MHz, [24]  2470 MHz, [25]  2475 MHz,
                  [26]  2480 MHz
           tx_powers:
                  3 dBm, 2.8 dBm, 2.3 dBm, 1.8 dBm, 1.3 dBm, 0.7 dBm,
                  0 dBm, -1 dBm, -2 dBm, -3 dBm, -4 dBm, -5 dBm,
                  -7 dBm, -9 dBm, -12 dBm, -17 dBm,
          cca_ed_levels:
                  -91 dBm, -89 dBm, -87 dBm, -85 dBm, -83 dBm, -81 dBm,
                  -79 dBm, -77 dBm, -75 dBm, -73 dBm, -71 dBm, -69 dBm,
                  -67 dBm, -65 dBm, -63 dBm, -61 dBm,
          cca_modes:
              (1) Energy above threshold
             (2) Carrier sense only
             (3, cca_opt: 0) Carrier sense with energy above threshold (logical operator is 'and')
             (3, cca_opt: 1) Carrier sense with energy above threshold (logical operator is 'or')
         min_be: 0,1,2,3,4,5,6,7,8
          max_be: 3,4,5,6,7,8
          csma_backoffs: 0,1,2,3,4,5
          frame_retries: 3
          lbt: false</code></pre>
</div>
</div>
</li>
<li>
<p>Next, set the Channel for the 802.15.4 device on the Linux machine</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">sudo iwpan phy phy0 set channel 0 26</code></pre>
</div>
</div>
</li>
<li>
<p>Then, set the PAN identifier for the 802.15.4 device on the Linux
machine <code>sudo iwpan dev wpan0 set pan_id 0xabcd</code> ## Create a
6LowPAN Network Interface</p>
</li>
<li>
<p>Associate the <code>wpan0</code> device to a new, 6lowpan network interface</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">sudo ip link add link wpan0 name lowpan0 type lowpan</code></pre>
</div>
</div>
</li>
<li>
<p>Finally, set the links up for both <code>wpan0</code> and <code>lowpan0</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">sudo ip link set wpan0 up
sudo ip link set lowpan0 up</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>We should observe something like the following when we run
<code>ip a show lowpan0</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">ip a show lowpan0
37: lowpan0@wpan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1280 qdisc noqueue state UNKNOWN group default qlen 1000
    link/6lowpan 9e:0b:a4:e8:00:d3:45:53 brd ff:ff:ff:ff:ff:ff:ff:ff
    inet6 fe80::9c0b:a4e8:d3:4553/64 scope link
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueping-pong"><a class="anchor" href="#trueping-pong"></a>Ping Pong</h3>
<div class="sect3">
<h4 id="truebroadcast-ping"><a class="anchor" href="#truebroadcast-ping"></a>Broadcast Ping</h4>
<div class="paragraph">
<p>Now, perform a broadcast ping to see what else is listening on
<code>lowpan0</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">$ ping6 -I lowpan0 ff02::1
PING ff02::1(ff02::1) from fe80::9c0b:a4e8:d3:4553%lowpan0 lowpan0: 56 data bytes
64 bytes from fe80::9c0b:a4e8:d3:4553%lowpan0: icmp_seq=1 ttl=64 time=0.099 ms
64 bytes from fe80::9c0b:a4e8:d3:4553%lowpan0: icmp_seq=2 ttl=64 time=0.125 ms
64 bytes from fe80::cf99:a11c:4b:1200%lowpan0: icmp_seq=2 ttl=64 time=17.3 ms (DUP!)
64 bytes from fe80::9c0b:a4e8:d3:4553%lowpan0: icmp_seq=3 ttl=64 time=0.126 ms
64 bytes from fe80::cf99:a11c:4b:1200%lowpan0: icmp_seq=3 ttl=64 time=9.60 ms (DUP!)
64 bytes from fe80::9c0b:a4e8:d3:4553%lowpan0: icmp_seq=4 ttl=64 time=0.131 ms
64 bytes from fe80::cf99:a11c:4b:1200%lowpan0: icmp_seq=4 ttl=64 time=14.9 ms (DUP!)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Yay! We have pinged (pung?) the Zephyr device over IEEE 802.15.4 using
6LowPAN!</p>
</div>
</div>
<div class="sect3">
<h4 id="trueping-zephyr"><a class="anchor" href="#trueping-zephyr"></a>Ping Zephyr</h4>
<div class="paragraph">
<p>We can ping the Zephyr device directly without a broadcast ping too, of
course.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">$ ping6 -I lowpan0 fe80::cf99:a11c:4b:1200
PING fe80::cf99:a11c:4b:1200(fe80::cf99:a11c:4b:1200) from fe80::9c0b:a4e8:d3:4553%lowpan0 lowpan0: 56 data bytes
64 bytes from fe80::cf99:a11c:4b:1200%lowpan0: icmp_seq=1 ttl=64 time=16.0 ms
64 bytes from fe80::cf99:a11c:4b:1200%lowpan0: icmp_seq=2 ttl=64 time=13.8 ms
64 bytes from fe80::cf99:a11c:4b:1200%lowpan0: icmp_seq=3 ttl=64 time=9.77 ms
64 bytes from fe80::cf99:a11c:4b:1200%lowpan0: icmp_seq=5 ttl=64 time=11.5 ms</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueping-linux"><a class="anchor" href="#trueping-linux"></a>Ping Linux</h4>
<div class="paragraph">
<p>Similarly, we can ping the Linux host from the Zephyr shell.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">uart:~$ net ping --help
ping - Ping a network host.
Subcommands:
  --help  :'net ping [-c count] [-i interval ms] &lt;host&gt;' Send ICMPv4 or ICMPv6
           Echo-Request to a network host.
$ net ping -c 5 fe80::9c0b:a4e8:d3:4553
PING fe80::9c0b:a4e8:d3:4553
8 bytes from fe80::9c0b:a4e8:d3:4553 to fe80::cf99:a11c:4b:1200: icmp_seq=0 ttl=64 rssi=110 time=11 ms
8 bytes from fe80::9c0b:a4e8:d3:4553 to fe80::cf99:a11c:4b:1200: icmp_seq=1 ttl=64 rssi=126 time=9 ms
8 bytes from fe80::9c0b:a4e8:d3:4553 to fe80::cf99:a11c:4b:1200: icmp_seq=2 ttl=64 rssi=128 time=13 ms
8 bytes from fe80::9c0b:a4e8:d3:4553 to fe80::cf99:a11c:4b:1200: icmp_seq=3 ttl=64 rssi=126 time=10 ms
8 bytes from fe80::9c0b:a4e8:d3:4553 to fe80::cf99:a11c:4b:1200: icmp_seq=4 ttl=64 rssi=126 time=7 ms</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueassign-a-static-address"><a class="anchor" href="#trueassign-a-static-address"></a>Assign a Static Address</h4>
<div class="paragraph">
<p>So far, we have been using IPv6 Link-Local addressing. However, the
Zephyr application is configured to use a statically configured IPv6
address as well which is, namely <code>2001:db8::1</code>.</p>
</div>
<div class="paragraph">
<p>If we add a similar static IPv6 address to our Linux IEEE 802.15.4
network interface, <code>lowpan0</code>, then we should expect to be able to reach
that as well.</p>
</div>
<div class="paragraph">
<p>In Linux, run the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">sudo ip -6 addr add 2001:db8::2/64 dev lowpan0</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can verify that the address has been set by examining the <code>lowpan0</code>
network interface again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">$ ip a show lowpan0
37: lowpan0@wpan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1280 qdisc noqueue state UNKNOWN group default qlen 1000
    link/6lowpan 9e:0b:a4:e8:00:d3:45:53 brd ff:ff:ff:ff:ff:ff:ff:ff
    inet6 2001:db8::2/64 scope global
       valid_lft forever preferred_lft forever
    inet6 fe80::9c0b:a4e8:d3:4553/64 scope link
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, ping the statically configured IPv6 address of the Zephyr
device.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">$ ping6 2001:db8::1
PING 2001:db8::1(2001:db8::1) 56 data bytes
64 bytes from 2001:db8::1: icmp_seq=2 ttl=64 time=53.7 ms
64 bytes from 2001:db8::1: icmp_seq=3 ttl=64 time=13.1 ms
64 bytes from 2001:db8::1: icmp_seq=4 ttl=64 time=22.0 ms
64 bytes from 2001:db8::1: icmp_seq=5 ttl=64 time=22.7 ms
64 bytes from 2001:db8::1: icmp_seq=6 ttl=64 time=18.4 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have set up a reliable transport, let’s move on to the
application layer.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truegreybus"><a class="anchor" href="#truegreybus"></a>Greybus</h3>
<div class="paragraph">
<p>Hopefully the videos listed earlier provide a sufficient foundation to
understand what will happen shortly. However, there is still a bit more
preparation required.</p>
</div>
<div class="sect3">
<h4 id="truebuild-and-probe-greybus-kernel-modules"><a class="anchor" href="#truebuild-and-probe-greybus-kernel-modules"></a>Build and probe Greybus Kernel Modules</h4>
<div class="paragraph">
<p>Greybus was originally intended to work exclusively on the UniPro
physical layer. However, we’re using RF as our physical layer and TCP/IP
as our transport. As such, there was need to be able to communicate with
the Linux Greybus facilities through userspace, and out of that need
arose gb-netlink. The Netlink Greybus module actually does not care
about the physical layer, but is happy to usher Greybus messages back
and forth between the kernel and userspace.</p>
</div>
<div class="paragraph">
<p>Build and probe the gb-netlink modules (as well as the other Greybus
modules) with the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">cd ${WORKSPACE}/sw/greybus
make -j`nproc --all`
sudo make install
../load_gb_modules.sh</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truebuild-and-run-gbridge"><a class="anchor" href="#truebuild-and-run-gbridge"></a>Build and Run Gbridge</h4>
<div class="paragraph">
<p>The gbridge utility was created as a proof of concept to abstract the
Greybus Netlink datapath among several reliable transports. For the
purposes of this tutorial, we’ll be using it as a TCP/IP bridge.</p>
</div>
<div class="paragraph">
<p>To run <code>gbridge</code>, perform the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">sudo apt install -y libnl-3-dev libnl-genl-3-dev libbluetooth-dev libavahi-client-dev
cd gbridge
autoreconf -vfi
GBNETLINKDIR=${PWD}/../greybus \
  ./configure --enable-uart --enable-tcpip --disable-gbsim --enable-netlink --disable-bluetooth
make -j`nproc --all`
sudo make install
gbridge</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueblinky"><a class="anchor" href="#trueblinky"></a>Blinky!</h3>
<div class="paragraph">
<p>Now that we have set up a reliable TCP transport, and set up the Greybus
modules in the Linux kernel, and used Gbridge to connect a Greybus node
to the Linux kernel via TCP/IP, we can now get to the heart of the
demonstration!</p>
</div>
<div class="paragraph">
<p>First, save the following script as <code>blinky.sh</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">#!/bin/bash
​
# Blinky Demo for CC1352R SensorTag
​
# /dev/gpiochipN that Greybus created
CHIP="$(gpiodetect | grep greybus_gpio | head -n 1 | awk '{print $1}')"
​
# red, green, blue LED pins
RED=6
GREEN=7
BLUE=21
​
# Bash array for pins and values
PINS=($RED $GREEN $BLUE)
NPINS=${#PINS[@]}
​
for ((;;)); do
    for i in ${!PINS[@]}; do
        # turn off previous pin
        if [ $i -eq 0 ]; then
            PREV=2
        else
            PREV=$((i-1))
        fi
        gpioset $CHIP ${PINS[$PREV]}=0
​
        # turn on current pin
        gpioset $CHIP ${PINS[$i]}=1
​
        # wait a sec
        sleep 1
    done
done</code></pre>
</div>
</div>
<div class="paragraph">
<p>Second, run the script with root privileges: <code>sudo bash blinky.sh</code></p>
</div>
<div class="paragraph">
<p>The output of your minicom session should resemble the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">$ *** Booting Zephyr OS build zephyr-v2.3.0-1435-g40c0ed940d71  ***
[00:00:00.011,932] &lt;inf&gt; net_config: Initializing network
[00:00:00.111,938] &lt;inf&gt; net_config: IPv6 address: fe80::6c42:bc1c:4b:1200
[00:00:00.112,121] &lt;dbg&gt; greybus_service.greybus_service_init: Greybus initializing..
[00:00:00.112,426] &lt;dbg&gt; greybus_transport_tcpip.gb_transport_backend_init: Greybus TCP/IP Transport initializing..
[00:00:00.112,579] &lt;dbg&gt; greybus_transport_tcpip.netsetup: created server socket 0 for cport 0
[00:00:00.112,579] &lt;dbg&gt; greybus_transport_tcpip.netsetup: setting socket options for socket 0
[00:00:00.112,609] &lt;dbg&gt; greybus_transport_tcpip.netsetup: binding socket 0 (cport 0) to port 4242
[00:00:00.112,640] &lt;dbg&gt; greybus_transport_tcpip.netsetup: listening on socket 0 (cport 0)
[00:00:00.112,823] &lt;dbg&gt; greybus_transport_tcpip.netsetup: created server socket 1 for cport 1
[00:00:00.112,823] &lt;dbg&gt; greybus_transport_tcpip.netsetup: setting socket options for socket 1
[00:00:00.112,854] &lt;dbg&gt; greybus_transport_tcpip.netsetup: binding socket 1 (cport 1) to port 4243
[00:00:00.112,854] &lt;dbg&gt; greybus_transport_tcpip.netsetup: listening on socket 1 (cport 1)
[00:00:00.113,037] &lt;inf&gt; net_config: IPv6 address: fe80::6c42:bc1c:4b:1200
[00:00:00.113,250] &lt;dbg&gt; greybus_transport_tcpip.netsetup: created server socket 2 for cport 2
[00:00:00.113,250] &lt;dbg&gt; greybus_transport_tcpip.netsetup: setting socket options for socket 2
[00:00:00.113,281] &lt;dbg&gt; greybus_transport_tcpip.netsetup: binding socket 2 (cport 2) to port 4244
[00:00:00.113,311] &lt;dbg&gt; greybus_transport_tcpip.netsetup: listening on socket 2 (cport 2)
[00:00:00.113,494] &lt;dbg&gt; greybus_transport_tcpip.netsetup: created server socket 3 for cport 3
[00:00:00.113,494] &lt;dbg&gt; greybus_transport_tcpip.netsetup: setting socket options for socket 3
[00:00:00.113,525] &lt;dbg&gt; greybus_transport_tcpip.netsetup: binding socket 3 (cport 3) to port 4245
[00:00:00.113,555] &lt;dbg&gt; greybus_transport_tcpip.netsetup: listening on socket 3 (cport 3)
[00:00:00.113,861] &lt;inf&gt; greybus_transport_tcpip: Greybus TCP/IP Transport initialized
[00:00:00.116,149] &lt;inf&gt; greybus_service: Greybus is active
[00:00:00.116,546] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: calling poll
[00:45:08.397,399] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: poll returned 1
[00:45:08.397,399] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: socket 0 (cport 0) has traffic
[00:45:08.397,491] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: accepted connection from [2001:db8::2]:39638 as fd 4
[00:45:08.397,491] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: spawning client thread..
[00:45:08.397,735] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: calling poll
[00:45:08.491,363] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: poll returned 1
[00:45:08.491,363] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: socket 3 (cport 3) has traffic
[00:45:08.491,455] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: accepted connection from [2001:db8::2]:39890 as fd 5
[00:45:08.491,455] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: spawning client thread..
[00:45:08.491,699] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: calling poll
[00:45:08.620,056] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: poll returned 1
[00:45:08.620,086] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: socket 2 (cport 2) has traffic
[00:45:08.620,147] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: accepted connection from [2001:db8::2]:42422 as fd 6
[00:45:08.620,147] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: spawning client thread..
[00:45:08.620,422] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: calling poll
[00:45:08.679,504] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: poll returned 1
[00:45:08.679,534] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: socket 1 (cport 1) has traffic
[00:45:08.679,595] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: accepted connection from [2001:db8::2]:48286 as fd 7
[00:45:08.679,595] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: spawning client thread..
[00:45:08.679,870] &lt;dbg&gt; greybus_transport_tcpip.accept_loop: calling poll
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueread-i2c-registers"><a class="anchor" href="#trueread-i2c-registers"></a>Read I2C Registers</h3>
<div class="paragraph">
<p>The SensorTag comes with an opt3001 ambient light sensor as well as an
hdc2080 temperature &amp; humidity sensor.</p>
</div>
<div class="paragraph">
<p>First, find which i2c device corresponds to the SensorTag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">ls -la /sys/bus/i2c/devices/* | grep "greybus"
lrwxrwxrwx 1 root root 0 Aug 15 11:24 /sys/bus/i2c/devices/i2c-8 -&gt; ../../../devices/virtual/gb_nl/gn_nl/greybus1/1-2/1-2.2/1-2.2.2/gbphy2/i2c-8</code></pre>
</div>
</div>
<div class="paragraph">
<p>On my machine, the i2c device node that Greybus creates is /dev/i2c-8.</p>
</div>
<div class="paragraph">
<p>Read the ID registers (at the i2c register address 0x7e) of the opt3001
sensor (at i2c bus address 0x44) as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">i2cget -y 8 0x44 0x7e w
0x4954</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read the ID registers (at the i2c register address 0xfc) of the hdc2080
sensor (at i2c bus address 0x41) as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">i2cget -y 8 0x41 0xfc w
0x5449</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueconclusion"><a class="anchor" href="#trueconclusion"></a>Conclusion</h3>
<div class="paragraph">
<p>The blinking LED can and poking i2c registers can be a somewhat
anticlimactic, but hopefully it illustrates the potential for Greybus as
an IoT application layer protocol.</p>
</div>
<div class="paragraph">
<p>What is nice about this demo, is that we’re using Device Tree to
describe our Greybus Peripheral declaratively, they Greybus Manifest is
automatically generated, and the Greybus Service is automatically
started in Zephyr.</p>
</div>
<div class="paragraph">
<p>In other words, all that is required to replicate this for other IoT
devices is simply an appropriate Device Tree overlay file.</p>
</div>
<div class="paragraph">
<p>The proof-of-concept involving Linux, Zephyr, and IEEE 802.15.4 was
actually fairly straight forward and was accomplished with mostly
already-upstream source.</p>
</div>
<div class="paragraph">
<p>For Greybus in Zephyr, there is still a considerable amount of
integration work to be done, including
* converting the fork to a proper
Zephyr module
* adding security and authentication
* automatic
detection, joining, and rejoining of devices</p>
</div>
<div class="paragraph">
<p>Thanks for reading, and we hope you’ve enjoyed this tutorial.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Complexity can be seen by exploring <a href="https://www.arduino.cc/reference/en/libraries/category/sensors/">Arduino sensor libraries</a>
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. If the cc2538-bs1.py command fails, see Flashing via a Linux Host below
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. If the cc2538-bs1.py command fails, see Flashing via a Linux Host below
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-04-26 18:17:35 +0550
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>